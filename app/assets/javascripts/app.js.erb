var gexpress = angular.module('gexpress', ['ngResource','ngRoute']);

gexpress.config(['$routeProvider', '$locationProvider', function($routeProvider, $locationProvider) {
  $locationProvider.html5Mode(true);
  $routeProvider
    .when("/sell", { templateUrl: "<%= asset_path('welcome/sell.html') %>"})
    .when("/:device/:carrier/:memory/:condition/offer", { templateUrl: "<%= asset_path('offer.html') %>"})  
    .otherwise({ redirectTo: "/" });
  }]);


gexpress.controller("offercontroller",['$scope', '$http', '$routeParams', function($scope, $http, $routeParams) {
    console.log($routeParams);
      var url = "/sku/"+$routeParams['device']+'/'+$routeParams['carrier']+'/'+$routeParams['memory']
                +'/'+$routeParams['condition']+"/price.json";
    console.log(url);
    $http.get(url).success(function(sku) {
          console.log(sku)
          $scope.sku = sku
        });
}]);

gexpress.controller("maincontroller", ['$scope', '$http', '$location','$window', function($scope, $http, $location, $window) {
  $scope.skus = [];
  $scope.selectedIndex = -1;
  console.log("hello inside")
    $scope.devices = [
                       ["Iphone 6 Plus","img/choose-phone/1.png","iphone6plus"], 
                       ["Iphone 6", "img/choose-phone/2.png", "iphone6"],
                       ["Iphone 5S", "img/choose-phone/3.png","iphone5S"],
                       ["Iphone 5","img/choose-phone/4.png","iphone5"],
                       ["Iphone 5C","img/choose-phone/5.png","iphone5C"],
                       ["Iphone 4S", "img/choose-phone/6.png","iphone4S"],
                       ["Iphone 4", "img/choose-phone/7.png","iphone4"]
                       ];

  $scope.carriers = [
                        ["att","img/choose-carrier/att.png"],
                        ["verizon","img/choose-carrier/verizon.png"],
                        ["sprint","img/choose-carrier/sprint.png"],
                        ["tmobile","img/choose-carrier/tmobile.png"],
                        ["unlocked","img/choose-carrier/unlocked.png"]
                        ];
    $scope.sizes = {
                      "iphone6plus":["16","32","64","128"],
                      "iphone6":["16","32","64","128"],
                      "iphone5":["16","32","64"],
                      "iphone5c":["16","32","64"],
                      "iphone5s":["16","32","64"],
                      "iphone4":["8","16","64"],
                      "iphone4s":["8","16","32","64"]
                    };
    $scope.types=[["Flawless", "Looks like it has never been used.", "flawless"],
    ["Good", "Normal signs of use.", "good"],
    ["Broken", "The phone does not turn on or has seroius physical damage.", "broken"],
    ["Broken but working","Doesn't turn on.", "bbw"]];
    $scope.display_carrier = false;
    $scope.display_size = false;
    $scope.display_quality = false; 
    $scope.display_device = true;
    $scope.display_paid = false;
    $scope.device_sizes = $scope.sizes['iphone6plus'];        

    $scope.setDevice = function(device, index) {
      console.log("Set click");
      $scope.selectedDeviceIndex = index;
      $scope.selectDevice = true;
      $scope.display_carrier = true;
      $scope.device = device;
      $scope.display_device = false;
    };
    
    $scope.setCarrier = function(carrier, index) {
      $scope.selectedCarrierIndex = index;
      $scope.selectCarrier = true;
      $scope.display_size = true;
      $scope.device_sizes = $scope.sizes[$scope.device];
      $scope.carrier = carrier
    };

    $scope.setSize = function(size, index) {
      $scope.selectedMemoryIndex = index;
      $scope.selectMemory = true;
      $scope.memory = size;
      $scope.display_quality = true; 
    }

     $scope.setCondition = function(condition, index) {
      $scope.selectedConditionIndex = index;
      $scope.selectCondition = true;
      $scope.condition = condition;
      $scope.display_offer = true;
    }

    $scope.offer = function() {
      var route = "/"+$scope.device+"/"+$scope.carrier+"/"+$scope.memory+"/"+$scope.condition+"/offer";
      $location.path(route);
    }                     
}]);