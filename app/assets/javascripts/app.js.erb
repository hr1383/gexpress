var gexpress = angular.module('gexpress', ['ngResource','ngRoute','ngCookies']);

gexpress.config(['$routeProvider', '$locationProvider', function($routeProvider, $locationProvider) {
  $locationProvider.html5Mode(true);
  $routeProvider
    .when("/sell", { templateUrl: "<%= asset_path('welcome/sell.html') %>"})
    .when("/", { templateUrl: "<%= asset_path('welcome/index.html') %>"})
    .when("/checkout", { templateUrl: "<%= asset_path('welcome/checkout.html') %>"})
    .when("/shipping", { templateUrl: "<%= asset_path('welcome/shipping-address.html') %>"})
    .when("/confirm-details", { templateUrl: "<%= asset_path('welcome/confirm-details.html') %>"})
    .when("/thank-you", { templateUrl: "<%= asset_path('welcome/thank-you.html') %>"})
    .when("/:device/:carrier/:memory/:condition/offer", { templateUrl: "<%= asset_path('offer.html') %>"})  
    .otherwise({ redirectTo: "/" });
  }]);


gexpress.controller("confirmcntrl",['$scope', '$location','$cookieStore', function($scope, $location, $cookieStore) {
    console.log($cookieStore['shipping_address']);
    console.log($cookieStore['sku']);
    console.log($cookieStore['billing_address']);
    $scope.shipping_address = $cookieStore['shipping_address'];
    $scope.sku = $cookieStore['sku'];
    $scope.billing_address = $cookieStore['billing_address'];
    $scope.payment = $cookieStore['payment_check'];
    $scope.confirm = function() {
      $location.path("/thank-you");
    } 
}]);


gexpress.controller("shippingcntrl",['$scope', '$location','$cookieStore', function($scope, $location, $cookieStore) {
    $scope.saveAddr = function(shippingAddress) {
      $cookieStore['shipping_address'] = shippingAddress;
      $location.path("/confirm-details");
    } 
}]);

gexpress.controller("offercontroller",['$scope', '$http', '$routeParams','$cookieStore', 
    function($scope, $http, $routeParams, $cookieStore) {
    console.log($routeParams);
      var url = "/sku/"+$routeParams['device']+'/'+$routeParams['carrier']+'/'+$routeParams['memory']
                +'/'+$routeParams['condition']+"/price.json";
    console.log(url);
    $http.get(url).success(function(sku) {
          console.log(sku)
          $scope.sku = sku
          $cookieStore['sku'] = sku
        });
    $scope.checkout = function() {
      $location.path("/checkout");
    } 
}]);

gexpress.controller("checkoutcntrl",['$scope', '$cookieStore', '$location', function($scope, $cookieStore, $location) {
   console.log("at checkout " + $cookieStore['sku']);
   $scope.checkSelected=true
   $scope.saveAddr = function(address) {
        $cookieStore['billing_address'] = address;
        $cookieStore['payment_check'] = $scope.checkSelected 
        $location.path("/shipping");
   };

   $scope.selectPayment = function(payment) {
    console.log(payment);
    console.log(payment == 'check');
    if(payment == 'check') {
      $scope.checkSelected = true;
    } else {
      $scope.checkSelected = false;
    }
   }
}]);

gexpress.controller("welcomecontroller", ['$scope', function($scope) {
$scope.initSlider = function () {
          $(function () {
            // wait till load event fires so all resources are available
              $scope.$slider = $('.slider').bxSlider({
                  auto: true,
                  controls:false,
                  pager: false,
                  onSlideAfter: function (currentSlideNumber, totalSlideQty, currentSlideHtmlObject) {
                      $('.active-slide').removeClass('active-slide');
                      $('.slider>.item').eq(currentSlideHtmlObject + 1).addClass('active-slide')
                  },
                  onSliderLoad: function () {
                      $('.slider>.item').eq(1).addClass('active-slide')
                  } 
                });
          });          
      };
  $scope.initSlider();
}]);

gexpress.controller("maincontroller", ['$scope', '$http', '$location','$window', function($scope, $http, $location, $window) {
  $scope.skus = [];
  $scope.selectedIndex = -1;
  console.log("hello inside")
    $scope.devices = [
                       ["Iphone 6 Plus","img/choose-phone/1.png","iphone6plus"], 
                       ["Iphone 6", "img/choose-phone/2.png", "iphone6"],
                       ["Iphone 5S", "img/choose-phone/3.png","iphone5S"],
                       ["Iphone 5","img/choose-phone/4.png","iphone5"],
                       ["Iphone 5C","img/choose-phone/5.png","iphone5C"],
                       ["Iphone 4S", "img/choose-phone/6.png","iphone4S"],
                       ["Iphone 4", "img/choose-phone/7.png","iphone4"]
                       ];

  $scope.carriers = [
                        ["att","img/choose-carrier/att.png"],
                        ["verizon","img/choose-carrier/verizon.png"],
                        ["sprint","img/choose-carrier/sprint.png"],
                        ["tmobile","img/choose-carrier/tmobile.png"],
                        ["unlocked","img/choose-carrier/unlocked.png"]
                        ];
    $scope.sizes = {
                      "iphone6plus":["16","64","128"],
                      "iphone6":["16","64","128"],
                      "iphone5":["16","32","64"],
                      "iphone5c":["16","32","64"],
                      "iphone5s":["16","32","64"],
                      "iphone4":["8","16","64"],
                      "iphone4s":["8","16","32","64"]
                    };
    $scope.types=[["Flawless", "Looks like it has never been used.", "flawless"],
    ["Good", "Normal signs of use.", "good"],
    ["Broken", "The phone does not turn on or has seroius physical damage.", "broken"],
    ["Broken but working","Doesn't turn on.", "bad"]];
    $scope.display_carrier = false;
    $scope.display_size = false;
    $scope.display_quality = false; 
    $scope.display_device = true;
    $scope.display_paid = false;
    $scope.device_sizes = $scope.sizes['iphone6plus'];        

    $scope.setDevice = function(device, index) {
      $scope.selectedDeviceIndex = index;
      $scope.selectDevice = true;
      $scope.display_carrier = true;
      $scope.device = device;
      $scope.device_sizes = $scope.sizes[$scope.device];
      $scope.display_device = false;
    };
    
    $scope.setCarrier = function(carrier, index) {
      $scope.selectedCarrierIndex = index;
      $scope.selectCarrier = true;
      $scope.display_size = true;    
      $scope.carrier = carrier
    };

    $scope.setSize = function(size, index) {
      $scope.selectedMemoryIndex = index;
      $scope.selectMemory = true;
      $scope.memory = size;
      $scope.display_quality = true; 
    }

     $scope.setCondition = function(condition, index) {
      $scope.selectedConditionIndex = index;
      $scope.selectCondition = true;
      $scope.condition = condition;
      $scope.display_offer = true;
    }

    $scope.offer = function() {
      var route = "/"+$scope.device+"/"+$scope.carrier+"/"+$scope.memory+"/"+$scope.condition+"/offer";
      $location.path(route);
    }                     
}]);